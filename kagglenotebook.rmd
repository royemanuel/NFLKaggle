---
title: "Working Kaggle Notebook"
author: "Roy Emanuel"
output: word_document
---

# Initial Data Plots of the field during a play

The first step I took was to look at the tracking data to see if I
could plot it. This was pretty straightforward. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

Plot of the first play available. 


```{r echo = FALSE}
library(tidyverse)
library(rstan)
library(rstanarm)
options(mc.cores = parallel::detectCores())
rstan_options(auto_write = TRUE)
## load the week one data
w1 <- read_csv("week1.csv")
all_plays <- read_csv("plays.csv")

w1p1 <-
    w1 %>%
    filter(playId == 75)

## Plot the first pass play
ggplot(w1p1, aes(x, y, color = displayName)) +
    geom_point(alpha = 0.5) +
    xlim(0, 130) +
    ylim(0, 63.3) +
    theme(legend.position = "bottom") +
    theme_bw()
```

Let's look at the players involved with the football: football, Matt
Ryan, Julio Jones and Malcolm Jenkins.

```{r echo = FALSE, fig.width = 7, fig.height = 4}
w1p1ball <-
    w1p1 %>%
    filter(displayName == "Matt Ryan" |
           displayName == "Julio Jones" |
           displayName == "Football" |
           displayName == "Malcolm Jenkins")

ggplot(w1p1ball, aes(x, y, color = displayName)) +
    geom_point(alpha = 0.5) +
    xlim(0, 130) +
    ylim(0, 63.3) +
    theme(legend.position = "bottom") +
    theme_bw()

ggplot(w1p1ball, aes(time, s, color = displayName)) +
    geom_line() + 
    theme(legend.position = "bottom") +
    theme_bw()

ggplot(w1p1ball, aes(time, a, color = displayName)) +
    geom_line()  +
    theme(legend.position = "bottom") +
    theme_bw()
```

NExt, I'm going to plot a vector for each point showing where the
player is moving and how fast relatively. 

```{r echo=FALSE, fig.width = 7, fig.height = 4}
bld_vector <- function(trkdata) {
    no_football <-
        trkdata %>%
        filter(displayName != "Football")
    fastest <- max(no_football$s)
    trkdata <-
        trkdata %>%
        mutate(sNorm = s / fastest,
               dir_rad = dir * pi / 180,
               o_rad = o * pi / 180, 
               yVel = cos(dir_rad) * sNorm,
               xVel = sin(dir_rad) * sNorm)
    return(trkdata)
}

w1p1 <- bld_vector(w1p1)
ggplot(w1p1, aes(x, y, color = displayName)) +
    geom_point() +
    geom_segment(aes(xend = x + xVel, yend = y + yVel),
                 arrow = arrow(length = unit(0.1, "cm"))) +
    theme(legend.position = "bottom") +
    theme_bw()
```

The above plot doesn't really show much. Of course their direction
aligns with their next point in space. That doesn't do much. So let's
look where everyone is facing. 

The arrow vector shows the direction the player was facing during at
each time step. 

```{r echo=FALSE, fig.width=7, fig.height=4}

ggplot(w1p1, aes(x, y, color = displayName)) +
    geom_point() +
    geom_segment(aes(xend = x + sin(o_rad), yend = y + cos(o_rad) ),
                 arrow = arrow(length = unit(0.1, "cm"))) +
    theme(legend.position = "bottom") +
    theme_bw()

```

# Analysis

I want to find the relationship between defendersInTheBox, personnelO,
and expected points added (epa). EPA takes down, distance, and field
position into account, so we will consider these issues handled for
now. 

First we will build a linear model. The minimum recorded epa is
-11.94. The maximum recorded epa is 8.629. What is the likelihood?
What is the prior? Let's start with a normal likelihood, normal prior,
and see what comes out. Everything is additive, and away we go...

$$y_{i} \~ \text{Normal}\left(\mu_i, \sigma\right)$$

$$mu_i = \beta_0 + \beta_{def}x_{def,i} + \beta{off}x_{off,i}$$

$$\sigma \~ \text{Gamma}\left(0.1, 0.1\right)$$

